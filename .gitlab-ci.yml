stages:
  - sync

sync_to_github:
  stage: sync
  image: alpine:latest
  before_script:
    - apk add --no-cache git
    - git config --global user.name "Amine Saidi"
    - git config --global user.email "saidi.amine2023@gitlab.com"
  script:
    - echo "Token détecté ? ${GITHUB_TOKEN:+✅ Oui}" || echo "❌ Non"
    # Forcer checkout de master et récupérer tous les commits
    - git fetch origin master
    - git checkout master
    - git reset --hard origin/master
    # Ajouter le remote github seulement s'il n'existe pas
    - git remote get-url github >/dev/null 2>&1 || git remote add github https://oauth2:${GITHUB_TOKEN}@github.com/Spakalao/Todo-List.git
    - git push github --all
    - git push github --tags
  only:
    - master
  variables:
    GIT_DEPTH: "0"
